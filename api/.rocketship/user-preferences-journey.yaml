name: "User Preferences Journey"
vars:
  base_url: "https://httpbin.org"

tests:
  - name: "User sets display preferences"
    steps:
      - name: "Log preference update start"
        plugin: "log"
        config:
          message: "User is setting display preferences"
      - name: "Wait before sending preferences"
        plugin: "delay"
        config:
          duration: "500ms"
      - name: "Validate preference data"
        plugin: "script"
        config:
          language: "javascript"
          script: |
            save("theme", "dark");
      - name: "User sends preference configuration"
        plugin: "http"
        config:
          method: "GET"
          url: "{{ .vars.base_url }}/headers"
          headers:
            X-Custom-Header: "custom-value"
            X-Request-Id: "req-12345"
        assertions:
          - type: "status_code"
            expected: 200

  - name: "User receives personalized settings"
    steps:
      - name: "System returns user-specific settings"
        plugin: "http"
        config:
          method: "GET"
          url: "{{ .vars.base_url }}/response-headers?X-Test=hello"
        assertions:
          - type: "status_code"
            expected: 200

  - name: "User location is detected for localization"
    steps:
      - name: "Log localization check"
        plugin: "log"
        config:
          message: "Detecting user location for localization"
      - name: "System identifies user region"
        plugin: "http"
        config:
          method: "GET"
          url: "{{ .vars.base_url }}/ip"
        assertions:
          - type: "status_code"
            expected: 200
